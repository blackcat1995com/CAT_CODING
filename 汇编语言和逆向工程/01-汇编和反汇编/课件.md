## 汇编语言开发环境

学习8086CPU汇编语言需要在32位系统DOS环境中进行调试，目前的操作系统一般都是64位且升级到Windows10，最近我也在无数次系统提醒之下按下了Window11更新，这些都无法启动debug.exe。

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/3d1e806205d74981ab17a912bdbca93b~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=YrULgTvCXZWW1ZCnmJIKyUItL8w%3D)

因此，我们可以使用DOSBox工具，可以在多种操作系统中支持DOS环境，**首先下载好DOSBox和debug.exe，我将这两个可执行文件放到桌面文件夹asm中。**

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/2bd70e8e469d415c9ff1ffb438d48ad9~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=YulgwTcCWhIM18fbLx4Ufjld5VY%3D)

双击DOSBox安装包，一路下一步流畅无脑安装。然后双击启动：

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/317e6889aa2b4c4ea80d7137693ca2b3~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=Bi%2FsqQjSY%2FMvOJ8zORZYV5cBXr0%3D)

挂载目录：

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/9dbf1eda96c943c3bc43edc5b5343d3f~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=%2BPw7h5HJarm1wCL81zVU2%2FfeG7E%3D)

然而，每次启动都要执行命令，比较麻烦，可以直接找到下面文件：

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/61d69a3282ac49cd8282a090e88c598c~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=U4C2tu7B1JNFpZxKS6Cg%2FU3IzN0%3D)

```cpp
文件位置（需要设置显示隐藏文件）：
C:\Users\Cat\AppData\Local\DOSBox\C:\Users\Cat\AppData\Local\DOSBox
在最后面加上指令：

[autoexec]
# Lines in this section will be run at startup.
# You can put your MOUNT lines here.
mount c: c:/Users/Cat/Desktop/asm
c:
```

调整界面大小：

```cpp
# windowresolution=original
# output=surface
windowresolution=1080x800
output=opengl
```

 

## 入栈出栈

编程：

1. 将1000H~1000FH这段空间当作栈，初始状态栈是空的；
2. 设置AX=001AH，BX=001BH；
3. 将AX、BX中的数据入栈；
4. 然后将AX、BX清零；
5. 从栈中恢复AX、BX原来内容。

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/62ed26a6e2484bab8e888d6261cbae40~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=lSijRXUJFoI%2FvozwdLjo0BMPSxI%3D)

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/4dfad50fb71240f8a6bf164f192e9ea6~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=nnlStAr4ACn94Js7mBd2XbbPAkM%3D)

 

## 栈交换数据

编程：

1. 将1000H~1000FH这段空间当作栈，初始状态栈是空的；
2. 设置AX=001AH，BX=001BH；
3. 利用栈，交换AX和BX中的数据。

```cpp
……
pop ax
pop bx
```

 

## 栈写入数据

在10000H处写入字型数据2266H，可以使用如下程序实现：

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/a84b5494d57043ec98abe477fe015bba~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=uS4%2FKCtrEtyIqO1j3oGcAzbCv%2FQ%3D)

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/ccbe0af82bb54538a0fba291c98dfc3f~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=H%2FN%2Bf4NiDkKCQSeShnQHv5AEp%2Fk%3D)

下面，要求不使用**mov 内存单元,寄存器**指令实现此功能。

思考，利用入栈操作，设置栈段和栈顶指针再将数据入栈。

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/bfd40ba6dbfe4fa6ae2be0df62cac800~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=j0XAhTF5tSgIZ80ztwERvbvxE%2BE%3D)

 

## DOSBox运行asm文件

将masm.exe和link.exe放入asm文件夹，并创建t.asm文件，写入程序：

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/52a8941c6ffe4529a6d859de8ed54103~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=qqyIjvLXduvnIwm2EYBKMXDn0%2F4%3D)

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/c75a10e85b384f669b7b40ea017e9779~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=eFEQ%2FvFruUFAxRXNDUEmEkukX%2Fk%3D)

如果觉得编译链接过程比较繁琐，可以在配置文件中直接写好，每次执行文件重启DOSBox就可以，可以把DOSBox固定到桌面下方任务栏，文件名指定，比如t.asm，需要测试其他文件就要将新的程序复制过来。

 

## 内存数据累加

计算ffff:0~ffff:b单元中的数据的和，结果存储在dx中。

注意：

1.单元中数据为8位，不能直接累加到16位寄存器中；

2.可以使用一个16位寄存器做中介，将内存单元中的8位数据赋值到一个16位寄存器ax中，再累加到dx上。

```cpp
assume cs:codesg

codesg segment

start:mov ax,0ffffH
      mov ds,ax
      mov bx,0

      mov dx,0
      mov cx,12

    s:mov al,[bx]
      mov ah,0
      add dx,ax
      inc bx
      loop s
       
      mov ax,4c00H
      int 21H

codesg ends

end start
```

![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/958fc1d2229b488d963e1637d9f57f4d~tplv-obj.jpg?traceid=202302092130199376DA7F4574DF973F3D&x-expires=2147483647&x-signature=CJuAyefEoILiLv0FXWCzbvr9Zxg%3D)

测试时使用4个单元数据累加，用计算器进行验证，最终DX寄存器中的数值也是1BCH。

 